---
tags:
  - AI
  - DataRobot 
  - seminar
---

# DataRobotとは
藤井 製造業のグローバルマネージャー
Kaggler GM5〜6名。そのノウハウを自動化。kaggleから生まれた会社。  
データをドロップしたらモデル構築〜学習〜デプロイまで。  

メジャーリーグ事例。デトロイト。新選手が花形になるか予測。  
メジャーは100年のデータを蓄積している。  

日本の売上、特に製造業の比率が高い。

異なる分野でハンズオン開催予定。できたら月1。

---

# ハンズオン
山元祐也 製造業担当  

### 概要説明
時系列予測はアドオン機能。追加費用が必要。

時系列分析(売上,需要,etc)には目的変数や説明変数に曜日性、周期性などがあり独特な前処理が必要。  
DataRobotは全自動でやってくれる。  
自動バックテストもできる。時系列を意識したデータ分割するなど。調整も可能。
パラメータチューン済のXGBoost(Kaggleでメジャーなモデル)など持っている。  

標準だとAWSだがオンプレもある。  

データから統計特徴量は自動で作って可視化(グラフ作成)してくれる。  
Pythonでもできるが、DataRobotだととても楽。  
通し番号、固定値、定数倍など意味を持たない特徴は自動で除去してくれる。  

どの課題を時系列と見なすか？  
物性など科学法則などは時間に影響されない。  
売上、需要などは時間に影響される。  
不動産価格は特殊で中間。間取りなど物理的な特徴が効くが時系列も効く。

- 時系列モデリング：有料
時間に応じた特徴生成してくれる。
- 時間外検定：無料
時間関係なく統計的に処理する。

### データの事前処理
**データ：KaggleのWalmart売上予測コンペのデータセット**
今回のデータは店舗、部署、周別の打ち上げデータ。N週未来の売上を予測する。  
DataRobotが何単位のデータか推測してくれる（ミリ秒、分、時間、週など）  

祝日カレンダーなど、外部情報を追加することができる。
今回の例だと、売上や天気はわからないが、店舗の面積や祝日フラグなどは事前に分かるので、既知と設定する。 

### モデリング実行
実行モード
- オートパイロット：自動で網羅的に実行
- クイック：部分的に実行。短時間。
- マニュアル：準備できたモデルが提示されるので手で選択して実行。

Q：周期性の幅を指定（8週間など）すると、それより長いスパンの特徴が落ちないか？
去年のクリスマスのデータを今年のクリスマス予測に使うなどできなくなるのでは？
A：時系列特徴を生成する際の範囲指定であって、特徴量生成自体とは別物。指摘の特徴はちゃんと作られる。

実行すると複数モデルが並列実行される。
実行完了次第、モデルごとの評価値がランキング形式で表示される。
時系列のベースモデルも提示する。※直近の値（先週の値）を返す。基礎的だがある程度精度が出る。

Q：Dateも事前に既知なのでは？（ハンズオンで既知として指定しなかった）
A：Date自体から時系列特徴生成するわけではないので、問題ない。
既知か否かの設定は業務知識に基づく。間違える（知りえない情報を既知とする）と過剰適合する。

モデルごとの変数重要度を可視化できる。
重要度の仕組み：周辺化、marginalization
対象の特徴以外の影響を除外して、対象の値を動かして変動幅を見る手法。

### 結果①
単純にモデルに投入するだけだと精度が上がらない。

### DataRobotの追加説明
*参考*
DataRobotブログ：https://blog.datarobot.com/jp

何を予測したいかはビジネス上のニーズによる。
予測問題に置いては精度良く予測できる予測単位が存在する。
- 単位が大きい＞情報が荒すぎて制度が出ない
- 単位が小さい＞ノイズが入る
**ソリューション**
- 小さい単位で予測して、予測結果を集約して特徴量として使う。
- 大きな単位の予測と、小さな単位の予測/大きな単位 の割合から予測値とする（階層モデリング）

### ハンズオン②：階層モデリング
同じデータで店舗別の売上予測＞店舗部門別の売上予測とする。  
用意されたデータでハンズオン。作業自体は前半と同じ。
- 部門別の集約されたデータでDataRobotを使って売上予測
- 前半で作った予測値を元に、店舗ごとの部門売上比を作り、部門の予測値を按分
- 手動で精度評価

新規店舗などデータが蓄積されていない場合は、時系列予測から除外して、立地など他の要素から予測したほうがいい場合もある。
精度が高いモデルがビジネス用途に合うとは限らない。モデル選択はビジネス用途による。

Q：時系列データが不規則な場合はどうする？
A：時系列が不規則すぎると、時系列として処理できなくなってくる。
不規則性が強い場合、DataRobot側でアラートを表示する。
製造業の場合、ショット数やサイクル数を扱いたい場合が多いと思う。その場合、行単位で扱うことができる。

### Tips
「どれくらいデータが必要か」という質問が多い。
時系列に関してはデータが少ないと予測できないし、過剰に多いと精度が下がる場合がある。多ければいいとは限らない
情報が陳腐化する。例えば株価予測において、100年前のデータは使えないのは明らか。
DataRobotではデータサイズごとの予測値を可視化できる。
どれくらいデータを増やすと精度があがるか、または落ちるかザックリ見える。
データの取得にも保管にもコストがかかるので、どれくらい保持するか考える必要がある。

統計特徴量は自動で作られるが、単純なモノのみ。平均、最大、最小、etc
高度な特徴量は手動で作る余地がある（特定サンプルから作成、指数移動平均、etc）

学習・予測時にデータの置換が可能。
例：在庫切れで売れなかったデータ＞何かしらの値で売上を保管する
（在庫があったら売れたはずなので、将来予測の上では売上ありと見なしたい、など）

これらの手動での処理は業務知識に大きく依存する。
（在庫が切れたのはなぜか？＞在庫がないのか、本当に売れなかったのか、など）

時系列予測に置いてはデータごとの重み付けも有効。
古いデータのウェイトを小さく、新しいデータのウェイトを大きくする等。
単純な処理はDataRobotのモデルにもある。高度なものは手動。

作成したモデルからシミュレーションが可能。
- 原材料の投入量で温度がどう変わるか
- マーケティング費用の増減がどう影響するか

時系列データの異常検知について。
動的しきい値を用いた異常値検知をすることがある。

### 総括
データ分析の多くの部分がDataRobotで自動化されている。
複数モデルの検証などスピーディにできる。
しかし、データの加工や検定方法などは業務知識は欠かせない。

## 所感
とても使いやすい。直感的に操作できる。
時系列の統計特徴量の作成はPythonで書くこともできるが、特に技術の違いが出る作業ではなく面倒な作業を淡々とやる、という側面が強い。これを自動実行してくれるのはとても便利。

手持ちのデータに対する前処理〜モデル作成は自動化されるが、テクニカルなことはできない。
今回の改装モデルのように、モデル1の予測結果をモデル2の特徴として使う、などのテクニックは自動化できない。

データサイエンティストがモデリング手法を考え、その実行を自動化するツールという印象。

---

# 備忘
- 短期の自己相関
- 周期性
- トレンド